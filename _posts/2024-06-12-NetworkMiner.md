---
title: NetworkMiner
date: 2024-06-11 00:00:00 -500
categories: [TryHackMe, Network Security]
tags: [TryHackMe]
---



- Open the tool folder and double click on the `.exe` file.

![](/assets/img/Pasted image 20240304142731.png)


# Intro to Network Forensics

- Network Forensics is a specific subdomain of the Forensics domain, and it focuses on network traffic investigation. Network Forensics discipline covers the work done to access information transmitted by listening and investigating live and recorded traffic, gathering evidence/artefacts and understanding potential problems.

- Briefly, it is the action of recording packets of network traffic and creating investigatable sources and establishing a root–cause analysis of an event. The ultimate goal is to provide sufficient information to detect malicious activities, security breaches, policy/regulation compliance, system health and user behaviour.


- The investigation process identifies communicated hosts in terms of:
```c
- Time
- Frequency
- Protocol
- Application
- Data
```


The investigation tries to answer the **5W**:
```c
- Who (Source IP and port)
- What (Data/payload)
- Where (Destination IP and port)
- When (Time and data)
- Why (How/What happened)
```

**Note that** the network evidence capture and investigation process should be systematic. Having enough data and the right timeline capture for a successful network forensics investigation is crucial.

	- Systematic
	- Data with right timeline


#### **Network Forensics Use Cases**  

The most common network forensics use cases are explained below:
```c
- ***Network discovery:*** Discovering the network to overview connected devices, rogue hosts and network load.   

- ***Packets reassembling:*** Reassembling the packets to investigate the traffic flow. This use case is helpful in unencrypted traffic flows.  

- ***Data leakage detection:*** Reviewing packet transfer rates for each host and destination address helps detect possible data leakage.   

- ***Anomaly and malicious activity detection:*** Reviewing overall network load by focusing on used ports, source and destination addresses, and data helps detect possible malicious activities along with vulnerabilities. This use case covers the correlation of indicators and hypotheses as well.  

- ***Policy/Regulation compliance control:*** Reviewing overall network behaviour helps detect policy/regulation compliance.
```


#### **Advantages of Network Forensics**

General advantages of network forensics are explained below:
```c
- **'Availability of network-based evidence in the wild':** Capturing network traffic is collecting evidence, so it is easier than other types of evidence collections such as logs and IOCs.

- **'Ease of data/evidence collection without creating noise':** Capturing and working with network traffic is easier than investigating unfiltered events by EDRs, EPPs and log systems. Usually, sniffing doesn''t create much noise, logs and alerts. The other thing is that network traffic is not destructible like logs and alerts generated by security systems.  

- **'It is hard to destroy the network evidence, as it is the transferred data':** Since the evidence is the traffic itself, it is impossible to do anything without creating network noise. Still, it is possible to hide the artefacts by encrypting, tunnelling and manipulating the packets. So, the second fact is the challenge of this advantage. 

- **'Availability of log sources':** Logs provide valuable information which helps to correlate the chain of events and support the investigation hypothesis. The majority of the EDRs, EPPs and network devices create logs by default. Having log files is easy if the attacker/threat/malware didn''t erase/destroy them.

- **'It is possible to gather evidence for memory and non-residential malicious activities':** The malware/threat might reside in the memory to avoid detection. However, the series of commands and connections live in the network. So it is possible to detect non-residential threats with network forensics tools and tactics.
```


#### **Challenges of Network Forensics**  

General challenges of the network forensics are explained below:  

```c
- **'Deciding what to do':** One of the most difficult challenges of network forensics is "Deciding what to do". There are several purposes of carving networks; SOC, IH/IR and Threat Hunting. Observing, trapping, catching, or stopping an anomalous activity is also possible. 

- **'Sufficient data/evidence collection on the network':** One of the advantages of network forensics is "Ease of collecting evidence". However, the breadth of this concept poses a challenge. There are multiple points to consider in data/evidence collection.  


- **'Short data capture':** One of the challenges in data/evidence collection. Capturing all network activity is not applicable and operable. So, it is hard always to have the packet captures that covers pre, during and post-event. 

- **'The unavailability of full-packet capture on suspicious events':** Continuously capturing, storing and processing full-packets costs time and resources. The inability to have full-packet captures for a long time creates time gaps between captures, resulting in missing a significant part of an event of interest. Sometimes 'NetFlow' captures are used instead of full-packet captures to reduce the weight of having full-packet captures and increase the capture time. Note that full-packet captures provide full packet details and give the opportunity of event reconstruction, while 'NetFlow' provides high-level summary but not data/payload details.

- **'Encrypted traffic':** Encrypted data is another challenge of network forensics. In most cases, discovering the contents of the encrypted data is not possible. However, the encrypted data still can provide valuable information for the hypothesis like source and destination address and used services.

- **'GDPR and Privacy concerns in traffic recording':** Capturing the traffic is the same as "recording everything on the wire"; therefore, this act should comply with GDPR and business-specific regulations (e.g. HIPAA, PCI DSS and FISMA ).

- **'Nonstandard port usage':** One of the popular approaches in network forensics investigations is grabbing the low-hanging fruits in the first investigation step. Looking for commonly used patterns (like known ports and services used in enumeration and exploitation) is known as grabbing the low-hanging fruits. However, sometimes attackers/threats use nonstandard ports and services to avoid detection and bypass security mechanisms. Therefore sometimes, this ends up as a challenge of network forensics.

- **'Time zone issues':** Using a common time zone is important for big-scale event investigation. Especially when working with multiple resources over different time zones, usage of different time zones create difficulties in event correlation.

- **'Lack of logs':** Network forensics is not limited to investigating the network traffic data. Network devices and event logs are crucial in event correlation and investigation hypotheses. This fact is known by the attackers/threats as well; therefore these logs are often erased by them, in order to make the investigation more difficult.
```


#### Sources of Network Forensics Evidence  

Capturing proper network traffic requires knowledge and tools. Usually, there is a single chance of gathering the live traffic as evidence. There are multiple evidence resources to gather network forensics data.  

```c
- TAPS
- InLine Devices
- SPAN Ports
- Hubs
- Switches
- Routers
- DHCP Servers
- Name Servers
- Authentication Servers
- Firewalls
- Web Proxies
- Central Log Servers
- Logs (IDS/IPS, Application, OS, Device)
```



#### **Primary Purposes of Network Forensics**   

There are two primary purposes in Network Forensics investigations.

- **Security Operations (SOC):** Daily security monitoring activities on system performance and health, user behaviour, and security issues.

- **Incident Handling/Response and Threat Hunting:** During/Post-incident investigation activities on understanding the reason for the incident, detecting malicious and suspicious activity, and investigating the data flow content.


#### **Investigated Data Types in Network Forensics**

There are three main data types investigated in Network Forensics

- **Live Traffic**
- **Traffic Captures (full packet captures and network flows)**
- **Log Files**

***NetworkMiner*** is capable of processing and handling packet pictures and live traffic. Therefore, we will focus on live and captured traffic in this room. Both of these data sources are valuable for forensics investigations. 


***Traffic investigation*** actions fall under network forensics's "`Traffic Analysis`" subdomain. However, the main purpose of the `NetworkMiner` is to investigate the OVERALL flow/condition of the limited amount of traffic, not for a long in-depth live traffic investigation. Therefore we will focus on how to use `NetworkMiner` for this purpose. In-depth traffic and packet analysis will be covered in the rooms below;  
  

- [Wireshark](https://tryhackme.com/room/wireshark)
- Tcpdump (available soon!)
- Tshark (available soon!)

------------
# What is NetworkMiner?

![](/assets/img/Pasted image 20240304143944.png)

	- https://github.com/xnih/satori/
	- https://lcamtuf.coredump.cx/p0f3/


#### Operating Modes

There are two main operating modes:

- ***Sniffer Mode:*** Although it has a sniffing feature, it is not intended to use as a sniffer. The sniffier feature is available only on Windows. However, the rest of the features are available in Windows and Linux OS. Based on experience, the sniffing feature is not as reliable as other features. Therefore we suggest not using this tool as a primary sniffer. Even the official description of the tool mentions that this tool is a "`Network Forensics Analysis Tool`", but it can be used as a "`sniffer`". In other words, it is a Network Forensic Analysis Tool with but has a sniffer feature, but it is not a dedicated sniffer like Wireshark and tcpdump.

- ***Packet Parsing/Processing***: `NetworkMiner` can parse traffic captures to have a quick overview and information on the investigated capture. This operation mode is mainly suggested to grab the "low hanging fruit" before diving into a deeper investigation.


#### **Pros and Cons** for NetworkMiner

As mentioned in the previous task, NetworkMiner is mainly used to gain an overview of the network. Before starting to investigate traffic data, let's look at **the pros and cons of the NetworkMiner.**  

**Pros**:
```c
- OS fingerprinting
- Easy file extraction  
- Credential grabbing
- Clear text keyword parsing
- Overall overview
```


**Cons**:
```c
- Not useful in active sniffing
- Not useful for large pcap investigation
- Limited filtering
- Not built for manual traffic investigation
```


#### Differences Between Wireshark and NetworkMiner  

`NetworkMiner` and `Wireshark` have similar base features, but they separate in use purpose. Although main functions are identical, some of the features are much stronger for specific use cases.

The best practice is to record the traffic for offline analysis, quickly overview the pcap with `NetworkMiner` and go deep with Wireshark for further investigation.

![](/assets/img/Pasted image 20240304144527.png)


---------
# Tool Overview 1

#### Landing Page

This is the landing page of the `NetworkMiner`. Once you open the application, this screen loads up.

![](/assets/img/Pasted image 20240304145005.png)


#### File Menu

The file menu helps you load a `Pcap file` or receive `Pcap over IP`. You can also drag and drop pcap files as well.

![](/assets/img/Pasted image 20240304145104.png)

NetworkMiner also can receive `Pcaps over IP`. This room suggests using NetworkMiner as an initial investigation tool for low hanging fruit grabbing and traffic overview. Therefore, we will skip receiving Pcaps over IP in this room. You can read on receiving Pcap over IP from [here](https://www.netresec.com/?page=Blog&month=2011-09&post=Pcap-over-IP-in-NetworkMiner) and [here](http://www.gavinhollinger.com/2016/10/pcap-over-ip-to-networkminer.html).

#### Tools Menu

The tools menu helps you clear the dashboard and remove the captured data.

![](/assets/img/Pasted image 20240304145148.png)

#### Help Menu

The help menu provides information on updates and the current version:

![](/assets/img/Pasted image 20240304145156.png)


#### Case Panel  


The case panel `shows the list of the investigated pcap files`. You can reload/refresh, view metadata details and remove loaded files from this panel.

<u>Viewing metadata of loaded files</u>:

![](/assets/img/Pasted image 20240304145225.png)


#### **Hosts**

The "hosts" menu shows the identified hosts in the pcap file. This section provides information on:
```c
- IP address
- MAC address
- OS type
- Open ports
- Sent/Received packets
- Incoming/Outgoing sessions
- Host details
```

OS fingerprinting uses the Satori GitHub repo and p0f, and the MAC address database uses the mac-ages GitHub repo.

You can sort the identified hosts by using the sort menu. You can change the colour of the hosts as well. Some of the features (OSINT lookup) are available only in premium mode. The right-click menu also helps you to copy the selected value.

![](/assets/img/Pasted image 20240304145641.png)


#### **Sessions**

The session menu shows detected sessions in the pcap file. This section provides information on:
```c
- Frame number
- Client and server address
- Source and destination port
- Protocol
- Start time
```

![](/assets/img/Pasted image 20240304145828.png)

You can search for keywords inside frames with the help of the filtering bar. It is possible to filter specific columns of the session menu as well. This menu accepts four types of inputs:
- "`ExactPhrase`"
- "`AllWords`"
- "`AnyWord`"
- "`RegExe`"


#### **DNS**

The DNS menu shows DNS queries with details. This section provides information on:
```c
- Frame number
- Timestamp
- Client and server
- Source and destination port 
- IP TTL
- DNS time
- Transaction ID and type
- DNS query and answer
- Alexa Top 1M
```

Some of the features (Alexa Top 1M) are available only in premium mode. The search bar is available here as well:

![](/assets/img/Pasted image 20240304150112.png)


#### **Credentials**

The credentials menu shows extracted credentials and password [hashes](https://tryhackme.com/room/hashingcrypto101) from investigated pcaps. You can use [Hashcat](https://tryhackme.com/room/crackthehashlevel2) ([GitHub](https://github.com/hashcat/hashcat)) and [John the Ripper](https://tryhackme.com/room/johntheripper0) ([GitHub](https://github.com/openwall/john)) to decrypt extracted credentials. NetworkMiner can extract credentials including;  
```c
- Kerberos hashes
- NTLM hashes
- RDP cookies
- HTTP cookies
- HTTP requests
- IMAP
- FTP
- SMTP
- MS SQL
```

The right-click menu is helpful in this part as well. You can easily copy the `username` and `password` values:

![](/assets/img/Pasted image 20240304150153.png)


##### Questions and Answers

`->` **Use `mx-3.pcap`**

###### Under the `Hosts` tab:

- For the first machine:

![](/assets/img/Pasted image 20240304214451.png)

	- Notice there are two IP address assigned on the same MAC address. I guess there are TWO VMs?
	- Also notice the open TCP port is for http to for 'download.html'
	- The original IP address of the machine is 65.208.228.223
	- This is machine is a server.


- For the second machine:

![](/assets/img/Pasted image 20240304214809.png)

	- The IP address is 142.250.187.110
	- There is another IP address which is probably a VM? It is a VM! Look at the NIC vendor!


- For the third machine:

![](/assets/img/Pasted image 20240304215218.png)

	- Another VM? Yep, and exists in the server from the first machine.


-  For the fourth machine:

![](/assets/img/Pasted image 20240304215324.png)

	- This machine was trying to reach out to TWO servers:
		- 65.208.228.223 -> The actual server it is trying to connect to
		- 216.239.59.99 -> Used for DNS resolution for www.ethereal.com
	- This also captures the web browser used from this machine when the outbound session was made.


- For the fifth machine:

![](/assets/img/Pasted image 20240304215709.png)

	- This is the host machine of the VM with the IP of 142.250.187.110?
	- Wait, who's who? Unless these are VMs but on bridge mode networking?
		- Reference: [Chapter 6. Virtual Networking (virtualbox.org)](https://www.virtualbox.org/manual/ch06.html)


- For the sixth machine:

![](/assets/img/Pasted image 20240304220016.png)

	- Another VM again with the same case as the fifth machine probably...


- For the seventh machine:

![](/assets/img/Pasted image 20240304220111.png)

	- This is a DNS server(I think?) underneath the host machine '65.208.228.223'


- For the eighth machine: (Not used)

![](/assets/img/Pasted image 20240304220257.png)

	- It is also a DNS server but was turned off.


###### Under the `Files` tab:

![](/assets/img/Pasted image 20240304220721.png)

	- There are two filenames gathered from different servers; one is from a DNS server hosting 'pagead.google.akadns.net' and the other is from an actual web server hosting the 'www.ethereal.com'.

![](/assets/img/Pasted image 20240304220741.png)

	- Also notice that the way it was downloaded uses Http.
	- The full download paths are under the details sub-tab.

<u>From the download.html</u>:

![](/assets/img/Pasted image 20240304222319.png)


<u>From the ads.720DB241.html</u>:

![](/assets/img/Pasted image 20240304222401.png)


###### Under the `Sessions` tab:

![](/assets/img/Pasted image 20240304221012.png)


###### Under the `DNS` tab:

![](/assets/img/Pasted image 20240304221115.png)![](/assets/img/Pasted image 20240304221149.png)

	- There are 41 DNS sessions captured coming from the same server serving at port 53 (usual)
	- There are two transactions visible:
		- CNAME: a type of DNS record that maps an alias name to a true or canonical domain name
		- HostAddress: hostname resolution


##### Under the `Parameters` tab:

![](/assets/img/Pasted image 20240304221838.png)

	- Shows all the parameter value from every web request that has been done in the network along with the source host and ports with their destination host and ports.
	- Timestamps are also included!


`->` What is the total number of frames?
From the `Case Panel` on the left hand side, right click on the first element and then click on the ***Metadata***

![](/assets/img/Pasted image 20240304222949.png)

![](/assets/img/Pasted image 20240304223152.png)


**Use `mx-4.pcap`**

![](/assets/img/Pasted image 20240304223455.png)


###### Under the `Credentials` tab:

![](/assets/img/Pasted image 20240304223525.png)

###### Under the `Sessions` tab:

![](/assets/img/Pasted image 20240304223545.png)


###### Under the `DNS` session:

![](/assets/img/Pasted image 20240304223622.png)


###### Under the `Files` tab:

![](/assets/img/Pasted image 20240304223641.png)


<u>Details from the third file</u>:

![](/assets/img/Pasted image 20240304223835.png)


<u>Details from the fourth file</u>:

![](/assets/img/Pasted image 20240304223816.png)


-------------
# Tool Overview 2

### **Files**

The file menu shows extracted files from investigated pcaps. This section provides information on:
```c
- Frame number
- Filename
- Extension
- Size
- Source and destination address
- Source and destination port
- Protocol
- Timestamp
- Reconstructed path
- Details
```

Some features (OSINT hash lookup and sample submission) are available only in premium mode. The search bar is available here as well. The right-click menu is helpful in this part as well. You can easily open files and folders and view the file details in-depth:

![](/assets/img/Pasted image 20240304224020.png)


##### Images

The file menu shows extracted images from investigated pcaps. The right-click menu is helpful in this part as well. You can open files and zoom in & out easily:

![](/assets/img/Pasted image 20240304224059.png)


Once you hover over the image, it shows the file's detailed information (`source` & `destination address` and `file path`):

![](/assets/img/Pasted image 20240304224113.png)


##### Parameters

The file menu shows extracted parameters from investigated pcaps. This section provides information on:
```c
- Parameter name
- Parameter value
- Frame number
- Source and destination host
- Source and destination port
- Timestamp
- Details
```

The right-click menu is helpful in this part as well. You can copy the parameters and values easily.

![](/assets/img/Pasted image 20240304224222.png)


##### Keywords

The file menu shows extracted keywords from investigated pcaps. This section provides information on:
```c
- Frame number
- Timestamp
- Keyword
- Context
- Source and destination host
- source and destination port
```

`->` How to filter keywords:
- Add keywords
- Reload case files!

**Note:** You can filter multiple keywords in this section; however, you must reload the case files after updating the search keywords. Keyword search investigates all possible data in the processed pcaps.

![](/assets/img/Pasted image 20240304224421.png)


##### Messages

The messages menu shows extracted emails, chats and messages from investigated pcaps. This section provides information on:
```c
- Frame number
- Source and destination host 
- Protocol
- Sender (From)
- Receiver (To)
- Timestamp
- Size
```


- Once you filter the traffic and get a hit, you will discover additional details like `attachments` and `attributes` on the selected message. Note that the search bar is available here as well.
- The right-click menu is available here.
- You can use the built-in viewer to investigate overall information and the "`open file`" option to explore attachments.

![](/assets/img/Pasted image 20240304224551.png)

	- Shows all the emails sent from the network



##### Anomalies

- The anomalies menu shows detected anomalies in the processed pcap. 
- Note that `NetworkMiner` isn't designated as an IDS. 
- However, developers added some detections for EternalBlue exploit and spoofing attempts.

![](/assets/img/Pasted image 20240304224647.png)


**Use mx-7 pcap**

What is the name of the Linux distro mentioned in the file associated with frame `63075`? `centos`

![](/assets/img/Pasted image 20240304231749.png)

![](/assets/img/Pasted image 20240304231828.png)



What is the header of the page associated with frame `75942`?
Another lead:
- Source host: 182.118.55.174
- Session:

![](/assets/img/Pasted image 20240304232830.png)

- Another frame related : `75939`
- Another file related: `index.html`

![](/assets/img/Pasted image 20240304233538.png)

- Contents of the `index.html` file related to this frame for this session:

![](/assets/img/Pasted image 20240304233642.png)


What is the source address of the image "`ads.bmp.2E5F0FD9.bmp`"? `80.239.178.187`

![](/assets/img/Pasted image 20240304233840.png)

What is the frame number of the possible ***TLS anomaly***? 

![](/assets/img/Pasted image 20240304233945.png)

	- Frames:
		- 36255
		- 73073


**Use mx-9 file**

Look at the messages. Which platform sent a password reset email? `Facebook`

![](/assets/img/Pasted image 20240304234513.png)



What is the email address of ***Branson Matheson***? `branson@sandsite.org`

![](/assets/img/Pasted image 20240304234542.png)


---------------
# Version Differences

### BASICALLY ALWAYS HAVE TWO DIFFERENT VERSIONS: `1.6.1` and `2.7.<something>`

As always, it wouldn't be surprising to see a feature improvement as the version goes up. Unsurprisingly version upgrades provide stability, security fixes and features. Here the feature part is quite tricky. Feature upgrades can represent implementing new features and updating the existing feature (`optimisation`, `alteration` or `operation mode modification`). You can always check the changelog [here](https://www.netresec.com/?page=NetworkMiner).  


Since there are some significant differences between the versions, the given VM has both of the major versions (`v1.6` and `v2.7`).

Of course, as the program version increases, it is expected to increase feature increase and scope. Here are the significant differences between versions 1.6 and 2.7. Here are the differences;  


##### **Mac Address Processing**

- `NetworkMiner` versions after version 2 can process MAC address specific correlation as shown in the picture below. This option will help you identify if there is a MAC Address conflict. This feature is not available before version 2.

![](/assets/img/Pasted image 20240304230401.png)


### Sent/Received Packet Processing

NetworkMiner versions up to version 1.6. can handle packets in much detail. These options will help you investigate the sent/received packets in a more detailed format. This feature is not available AFTER version 1.6.

![](/assets/img/Pasted image 20240304230436.png)


##### **Frame Processing**

NetworkMiner versions up to version 1.6. can handle frames. This option provides the number of frames and essential details about the frames. This feature is not available after version 1.6.

![](/assets/img/Pasted image 20240304230509.png)



##### **Parameter Processing**

NetworkMiner versions after version 2 can handle parameters in a much more `extensive` form. Therefore version 1.6.xx catches fewer parameters than version 2.

![](/assets/img/Pasted image 20240304230539.png)



##### **Cleartext Processing**

- NetworkMiner versions up to version 1.6. can handle cleartext data. This option provides all extracted cleartext data in a single tab; it is beneficial to investigate cleartext data about the traffic data. 
- However, it is impossible to match the cleartext data and packets. This feature is NOT available AFTER version 1.6.

![](/assets/img/Pasted image 20240304230702.png)


##### Questions and Answers part

![](/assets/img/Pasted image 20240304234716.png)



-----
### Exercises

**Use case1.pcap**

- What is the OS name of the host `131.151.37.122`?

`Satori TCP: Windows - Windows NT 4 (50.00 %) Windows - Windows 98 (50.00 %) `

but the answer I believe is: `Windows - Windows NT 4`



- Investigate the hosts `131.151.37.122` and `131.151.32.91`.  

How many data bytes were received from host `131.151.32.91` to host `131.151.37.122` through port `1065`?

![](/assets/img/Pasted image 20240305000801.png)

	- Answer is 192 bytes


- Investigate the hosts `131.151.37.122` and `131.151.32.21`.  

How many ***data bytes*** were received from host `131.151.37.122` to host `131.151.32.21` through port `143`?

![](/assets/img/Pasted image 20240305001128.png)

	- 20769 data bytes sent

  
- What is the sequence number of `frame 9`?

![](/assets/img/Pasted image 20240305001445.png)

	- Answer: 2AD77400


What is the number of the detected "`content types`"?

![](/assets/img/Pasted image 20240305002131.png)

	- There are only TWO content types



Use case2.pcap  

**Investigate the files.**  

- What is the USB product's brand name?

![](/assets/img/Pasted image 20240305015723.png)

	- 'Asix'


- What is the name of the phone model?

![](/assets/img/Pasted image 20240305020027.png)

	- Lumia 535


- What is the source IP of the fish image?

![](/assets/img/Pasted image 20240305020155.png)

	- 50.22.95.9


- What is the password of the "`homer.pwned.se@gmx.com`"?

![](/assets/img/Pasted image 20240305020329.png)

	- Password:spring2015




- What is the DNS Query of `frame 62001`? `gmx.something`










