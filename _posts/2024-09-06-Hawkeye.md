---
title: Hawkeye
date: 2024-09-06 00:00:00 -500
categories: [DFIR, Network Forensics]
tags: [CyberDefenders]
---

## Scenario:

An accountant at your organization received an email regarding an invoice with a download link. Suspicious network traffic was observed shortly after opening the email. As a SOC analyst, investigate the network trace and analyze exfiltration attempts.

## Tools:

- [Wireshark](https://www.wireshark.org/)
- [BrimSecurity](https://www.brimdata.io/)
- [Apackets](https://apackets.com/)
- [MaxMind Geo IP](https://wiki.wireshark.org/HowToUseGeoIP#:~:text=MaxMind%20produces%20databases%20and%20software,information%20for%20an%20IP%20address.)
- [VirusTotal](https://www.virustotal.com/gui/)

# Tags:

```c
[PCAP](https://cyberdefenders.org/blueteam-ctf-challenges/?tags=pcap)
[Wireshark](https://cyberdefenders.org/blueteam-ctf-challenges/?tags=wireshark)
[NetworkMiner](https://cyberdefenders.org/blueteam-ctf-challenges/?tags=networkminer)
[BRIM](https://cyberdefenders.org/blueteam-ctf-challenges/?tags=brim)
[VirusTotal](https://cyberdefenders.org/blueteam-ctf-challenges/?tags=virustotal)
[T1048](https://cyberdefenders.org/blueteam-ctf-challenges/?tags=t1048)
[T1071](https://cyberdefenders.org/blueteam-ctf-challenges/?tags=t1071)
[T1056.001](https://cyberdefenders.org/blueteam-ctf-challenges/?tags=t1056.001)
[T1016](https://cyberdefenders.org/blueteam-ctf-challenges/?tags=t1016)
[T1027](https://cyberdefenders.org/blueteam-ctf-challenges/?tags=t1027)
[T1204](https://cyberdefenders.org/blueteam-ctf-challenges/?tags=t1204)
[T1566.002](https://cyberdefenders.org/blueteam-ctf-challenges/?tags=t1566.002)
```

# Questions:

## `Q1`: How many packets does the capture have?

![](/assets/img/Pasted image 20240727205337.png)

-> Answer: `4003`


## `Q2`: At what time was the first packet captured?

Go to `View > Time display format > UTC Date and Time of Day`

![](/assets/img/Pasted image 20240727205412.png)

-> Answer: `2019-04-10 20:37:07 UTC`


## `Q3`: What is the duration of the capture?

-> First packet capture time difference with the last packet capture time.

Go to `Statistics > Capture File Properties > Time > Elapsed`

![](/assets/img/Pasted image 20240727205519.png)

![](/assets/img/Pasted image 20240727205542.png)

-> Answer: `01:03:41`


## `Q4`: What is the most active computer at the link level?

Go to `Statistics > Endpoints > Ethernet column > sort by Packets`

![](/assets/img/Pasted image 20240727205613.png)

![](/assets/img/Pasted image 20240727205639.png)

-> Answer: `00:08:02:1c:47:ae`


## `Q5` Manufacturer of the NIC of the most active system at the link level?

Wireshark query:
```c
eth.addr == 00:08:02:1c:47:ae
```

	- Under 'Source', the manufacturer is printed.

![](/assets/img/Pasted image 20240727205735.png)

-> Answer: `Hewlett-Packard`


## `Q6` Where is the headquarter of the company that manufactured the NIC of the most active computer at the link level?

Just need Google Search on this.

-> Answer: `Palo Alto`


## `Q7`: The organization works with private addressing and netmask /24. How many computers in the organization are involved in the capture?

```c
10.4.10.2
10.4.10.4
10.4.10.132
10.4.10.255 -> subnet mask so does not count
```

![](/assets/img/Pasted image 20240727205832.png)

-> Answer: `3`


## `Q8` What is the name of the most active computer at the network level?

Go select a packet with the `10.4.10.132` was involved since this has the most packets transferred.

Follow the TCP stream:
![](/assets/img/Pasted image 20240727205957.png)

Can also check the `DHCP` packets:
![](/assets/img/Pasted image 20240727213301.png)


-> Answer: `BEIJING-5CD1-PC`


## `Q9` What is the IP of the organization's DNS server?

Wireshark query:
```c
dns
```

![](/assets/img/Pasted image 20240727210048.png)

-> Answer: `10.4.10.4`


## `Q10`: What domain is the victim asking about in packet 204?

![](/assets/img/Pasted image 20240727210131.png)

	- This is a malware site according to VirusTotal

-> Answer: `proforma-invoices.com`


## `Q11`: What is the IP of the domain in the previous question?

Following this stream:
![](/assets/img/Pasted image 20240727210447.png)

![](/assets/img/Pasted image 20240727210533.png)

	- IP of the malware site

-> Answer: `217.182.138.150`


## `Q12` Indicate the country to which the IP in the previous section belongs.

- Upload the MaxMind geoIP database.
- Go to `Endpoints > IPv4 column` then you should see it on the '`Country`' column:
![](/assets/img/Pasted image 20240727210820.png)


-> Answer: `France`


## `Q13` What operating system does the victim's computer run?

First, get all the connections to and from `217.182.138.150`:
![](/assets/img/Pasted image 20240727211127.png)

Following the stream:
![](/assets/img/Pasted image 20240727211411.png)

	- It shows that a 1st stage malware is being downloaded on the victim's sytem running on Windows OS.


-> Answer: `Windows NT 6.1`


## `Q14` What is the name of the malicious file downloaded by the accountant?

->Answer: `tkraw_Protected99.exe`


## `Q15` What is the md5 hash of the downloaded file?

Powershell script:
```c
Get-FileHash -Path "C:\Users\husky\Desktop\CCD_NetworkForensicsLabs\tkraw_Protected99.exe" -Algorithm MD5
```

![](/assets/img/Pasted image 20240727211944.png)

-> Answer: `71826BA081E303866CE2A2534491A2F7`


## `Q16` What software runs the webserver that hosts the malware?

![](/assets/img/Pasted image 20240727212157.png)

	- Its an Apache/Nginx alternative I guess

-> Answer: `LiteSpeed`


## `Q17` What is the public IP of the victim's computer?

Let's go and check which IP addresses did the victim computer talked to: (`Statistics > Conversations`)
![](/assets/img/Pasted image 20240727212517.png)

	- I crossed off the IP address that are probably for broadcasting or subnet.


What we have left:
```c
- 217.182.138.150 : not this since this is the webserver that hosts the malware
- 66.171.248.178 : seems to be another malware site / botnet
- 23.229.162.69 : seems to be a personal website 'briantharris.org' -> Seems to be a mailserver.
- 216.58.193.131 : Seems to be resolving to "Georgia Institute of Technology" -> most viable answer => Nope, its not it. Its google api update.
```

	- Looking up these IP addresses on VirusTotal

Another approach: from `Statistics > HTTP > Load Distribution` you can see that there is a request to `whatismyipaddress.com`. We can follow the stream on that and its response to the victim's computer
![](/assets/img/Pasted image 20240727214020.png)

![](/assets/img/Pasted image 20240727214037.png)

-> Answer: `173.66.146.112`


## `Q18` In which country is the email server to which the stolen information is sent?

From the previous searches, we determined that `23.229.162.69` is an email server which I suppose is compromised already/created by the attacker for this data exfiltration. Let's dig into this:
![](/assets/img/Pasted image 20240727214532.png)

	- Here is the conversation between the victim's computer and the mail server.
	- The attacker seems to already have the credential for this mailserver.
	- No clue about the 'secureserver.net' link

Checking the base64 encoded data:
```c
HawkEye Keylogger - Reborn v9
Passwords Logs
roman.mcguire \ BEIJING-5CD1-PC

===========================================
URL : https://login.aol.com/account/challenge/password
Web Browser : Internet Explorer 7.0 - 9.0
User Name : roman.mcguire914@aol.com
Password : P@ssw0rd$
Password Strength : Very Strong
User Name Field : 
Password Field : 
Created Time : 
Modified Time : 
Filename : 
===========================================


===========================================
URL : https://www.bankofamerica.com/
Web Browser : Chrome
User Name : roman.mcguire
Password : P@ssw0rd$
Password Strength : Very Strong
User Name Field : onlineId1
Password Field : passcode1
Created Time : 4/10/2019 2:35:17 AM
Modified Time : 
Filename : C:\Users\roman.mcguire\AppData\Local\Google\Chrome\User Data\Default\Login Data
==========================================================================================


==========================================================================================
Name : Roman Mcguire
Application : MS Outlook 2002/2003/2007/2010
Email : roman.mcguire@pizzajukebox.com
Server : pop.pizzajukebox.com
Server Port : 995
Secured : No
Type : POP3
User : roman.mcguire
Password : P@ssw0rd$
Profile : Outlook
Password Strength : Very Strong
SMTP Server : smtp.pizzajukebox.com
SMTP Server Port : 587
==========================================================================================



```

	- This malware HawkEye Keylogger is using mailserver as a C2.
	- These seems to be the data extracted by the keylogger sent on the mailserver encoded with Base64 encoding.
	- Name of the compromised user is 'Roman Mcguire'

-> Answer: `United States` => Look up `secureserver.net` on VirusTotal.com


## `Q19` Analyzing the first extraction of information. What software runs the email server to which the stolen data is sent?

Filter through `23.229.162.69`: `SMTP`
![](/assets/img/Pasted image 20240727221256.png)

-> Answer: `EXIM 4.91`


## `Q20`: To which email account is the stolen information sent?

![](/assets/img/Pasted image 20240727221353.png)

	- I guess the mail sending server for domain 'macwinlogistics.in' doesn't have email protections as any send mail server can be used to send emails allowing attackers to use the compromised email. Also, this 'secureserver.net' email server is definitely not one of the sending mail server for the 'macwinlogistics.in'.

-> Answer: `sales.del@macwinlogistics.in`


## `Q21`: What is the password used by the malware to send the email?

![](/assets/img/Pasted image 20240727221717.png)

![](/assets/img/Pasted image 20240727221922.png)

	- Password seems to be base64 encoded.
	- Password decode: Sales@23

-> Answer: `Sales@23`

## `Q22`: Which malware variant exfiltrated the data?

```c
HawkEye Keylogger - Reborn v9
Passwords Logs
roman.mcguire \ BEIJING-5CD1-PC
```

-> Answer: `Reborn v9`

## `Q23`: What are the bankofamerica access credentials? (username:password)

```c
===========================================
URL : https://www.bankofamerica.com/
Web Browser : Chrome
User Name : roman.mcguire
Password : P@ssw0rd$
Password Strength : Very Strong
User Name Field : onlineId1
Password Field : passcode1
Created Time : 4/10/2019 2:35:17 AM
Modified Time : 
Filename : C:\Users\roman.mcguire\AppData\Local\Google\Chrome\User Data\Default\Login Data
==========================================================================================
```

-> Answer: `roman.mcguire:P@ssw0rd$`

## `Q24`: Every how many minutes does the collected data get exfiltrated?

Check the first and last packet for SMTP:
```c
First: 69.160215
Last: 3777.862095
Difference: 3708.70188 == 61.811698 minutes
```

	- This is not correct as it extracts the first packet of the first session of data exfiltration and the last packet for the last session.

There's 10 minute interval for each data exfiltration session:
![](/assets/img/Pasted image 20240727223014.png)

-> Answer: `10`
